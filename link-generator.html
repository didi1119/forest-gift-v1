<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>知音大使專屬連結生成器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700&family=Noto+Sans+TC:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #FDFBF8;
            color: #5C544B;
        }
        h1, h2, h3, .font-serif {
            font-family: 'Noto Serif TC', serif;
        }
        .brand-accent {
            color: #2E4B36;
        }
        .brand-card {
            background-color: #FFFFFF;
            border: 1px solid #EAE6E1;
            border-radius: 1.5rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.05);
        }
        .link-box {
            background-color: #F8F5F2;
            border: 2px dashed #2E4B36;
            border-radius: 0.75rem;
            padding: 1rem;
            font-family: monospace;
            font-size: 0.9rem;
            word-break: break-all;
        }
    </style>
</head>
<body class="antialiased min-h-screen py-12">
    <div class="max-w-4xl mx-auto px-6">
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold brand-accent mb-4">知音大使專屬連結生成器</h1>
            <p class="text-lg text-stone-600">為每位知音大使生成個人化的分享連結並寫入 Google Sheets</p>
        </header>

        <div class="brand-card p-8 mb-8">
            <h2 class="font-serif text-2xl font-semibold brand-accent mb-6">生成專屬連結</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                    <label class="block text-sm font-medium text-stone-700 mb-2">夥伴姓名 *</label>
                    <input type="text" id="partnerName" placeholder="例：王小明" class="w-full p-3 border-2 border-stone-200 rounded-lg focus:border-green-800 focus:outline-none">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-stone-700 mb-2">夥伴代碼 *</label>
                    <input type="text" id="partnerCode" placeholder="例：WANG001 或 xiaoming" class="w-full p-3 border-2 border-stone-200 rounded-lg focus:border-green-800 focus:outline-none">
                    <p class="text-xs text-stone-500 mt-1">建議格式：大寫字母+數字，例如 WANG001</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-stone-700 mb-2">Email</label>
                    <input type="email" id="partnerEmail" placeholder="partner@example.com" class="w-full p-3 border-2 border-stone-200 rounded-lg focus:border-green-800 focus:outline-none">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-stone-700 mb-2">優惠券代碼</label>
                    <input type="text" id="couponCode" placeholder="例：FOREST_WANG001" class="w-full p-3 border-2 border-stone-200 rounded-lg focus:border-green-800 focus:outline-none">
                    <p class="text-xs text-stone-500 mt-1">選填：如有專屬優惠券可填入</p>
                </div>
            </div>
            
            <div class="space-y-3">
                <button onclick="generateLinks()" class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 transition duration-300">
                    🔗 生成專屬連結
                </button>
                
                <button onclick="saveToSheets()" class="w-full bg-green-800 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-900 transition duration-300">
                    💾 儲存到 Google Sheets
                </button>
                
                <p class="text-xs text-stone-500 text-center">
                    生成連結後，請點擊「儲存到 Google Sheets」將資料寫入系統
                </p>
            </div>
        </div>

        <div id="resultSection" class="brand-card p-8 hidden">
            <h3 class="font-serif text-xl font-semibold brand-accent mb-4">生成結果</h3>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-stone-700 mb-2">主頁連結（透過中繼服務追蹤）</label>
                    <div class="link-box" id="landingLink">生成中...</div>
                    <button onclick="copyText('landingLink')" class="mt-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">複製連結</button>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-stone-700 mb-2">優惠券連結（透過中繼服務追蹤）</label>
                    <div class="link-box" id="couponLink">生成中...</div>
                    <button onclick="copyText('couponLink')" class="mt-2 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">複製連結</button>
                </div>
                
                <div class="bg-amber-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-amber-800 mb-2">📱 分享範本</h4>
                    <div class="text-sm text-amber-700 leading-relaxed">
                        <p id="shareTemplate"></p>
                    </div>
                    <button onclick="copyText('shareTemplate')" class="mt-3 px-3 py-1 bg-amber-600 text-white text-xs rounded hover:bg-amber-700">複製範本</button>
                </div>
                
                <div id="saveStatus" class="bg-gray-50 p-4 rounded-lg hidden">
                    <p class="text-gray-700">⏳ 尚未儲存到系統</p>
                </div>
            </div>
        </div>

        <div class="brand-card p-8 mt-8">
            <h3 class="font-serif text-xl font-semibold brand-accent mb-4">系統說明</h3>
            <div class="space-y-3 text-sm text-stone-600">
                <p><strong class="text-stone-800">連結追蹤：</strong>所有連結都會通過 Apps Script 中繼服務進行點擊追蹤</p>
                <p><strong class="text-stone-800">資料管理：</strong>夥伴資料會儲存在 Google Sheets，作為系統資料庫</p>
                <p><strong class="text-stone-800">績效統計：</strong>系統每日自動彙整點擊數與轉換數據</p>
                <p><strong class="text-stone-800">獎金計算：</strong>僅已付費且實際入住的訂房才算有效轉換</p>
            </div>
        </div>
    </div>

    <script>
        // 設定值（部署完成後會自動更新）
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/DEPLOYMENT_PLACEHOLDER/exec'; 
        const GITHUB_PAGES_URL = 'https://didi1119.github.io/forest-gift-v1'; 
        const LINE_COUPON_URL = 'https://line.me/R/ti/p/@foresthouse'; // 請提供實際 LINE 帳號
        
        let generatedData = null;
        
        function generateLinks() {
            const partnerCode = document.getElementById('partnerCode').value.trim();
            const partnerName = document.getElementById('partnerName').value.trim();
            const partnerEmail = document.getElementById('partnerEmail').value.trim();
            const couponCode = document.getElementById('couponCode').value.trim();
            
            if (!partnerCode || !partnerName) {
                alert('請填寫夥伴代碼和姓名');
                return;
            }
            
            // 生成透過 Apps Script 中繼的連結
            const landingUrl = `${APPS_SCRIPT_URL}?pid=${encodeURIComponent(partnerCode)}&dest=landing`;
            const couponUrl = `${APPS_SCRIPT_URL}?pid=${encodeURIComponent(partnerCode)}&dest=coupon`;
            
            // 生成分享範本
            const shareText = `🌲 來自靜謐森林的特別邀請

親愛的朋友，我想與你分享一個很特別的地方 —— 一片能讓心靈真正休息的森林。

這裡不只是住宿，更是一場回到內心家園的旅程。我為你準備了一份專屬的森林禮物，希望能為你的生活帶來一些不一樣的寧靜與感動。

🎁 點擊連結，開始你的森林之旅：
${landingUrl}

期待你也能在這裡，找到屬於自己的那份安靜。

—— ${partnerName} 真誠推薦 ❤️`;
            
            // 保存生成的資料
            generatedData = {
                partner_code: partnerCode,
                name: partnerName,
                email: partnerEmail,
                coupon_code: couponCode,
                landing_link: landingUrl,
                coupon_link: couponUrl
            };
            
            // 顯示結果
            document.getElementById('landingLink').textContent = landingUrl;
            document.getElementById('couponLink').textContent = couponUrl;
            document.getElementById('shareTemplate').textContent = shareText;
            document.getElementById('resultSection').classList.remove('hidden');
            document.getElementById('saveStatus').classList.remove('hidden');
            
            // 滾動到結果區域
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        async function saveToSheets() {
            if (!generatedData) {
                alert('請先生成連結');
                return;
            }
            
            const button = document.querySelector('button[onclick="saveToSheets()"]');
            const originalText = button.textContent;
            button.textContent = '儲存中...';
            button.disabled = true;
            
            try {
                // 這裡應該呼叫實際的 Apps Script 或後端 API
                // 暫時使用模擬的保存操作
                
                console.log('儲存資料到 Google Sheets:', generatedData);
                
                // 模擬 API 呼叫
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // 更新儲存狀態
                document.getElementById('saveStatus').innerHTML = `
                    <p class="text-green-700">✅ 已成功儲存到系統</p>
                    <p class="text-sm text-gray-600 mt-1">夥伴代碼：${generatedData.partner_code}</p>
                `;
                document.getElementById('saveStatus').className = 'bg-green-50 p-4 rounded-lg';
                
                alert('✅ 夥伴資料已儲存到 Google Sheets！');
                
            } catch (error) {
                console.error('儲存失敗:', error);
                alert('❌ 儲存失敗，請稍後再試');
                
                document.getElementById('saveStatus').innerHTML = `
                    <p class="text-red-700">❌ 儲存失敗</p>
                `;
                document.getElementById('saveStatus').className = 'bg-red-50 p-4 rounded-lg';
                
            } finally {
                button.textContent = originalText;
                button.disabled = false;
            }
        }
        
        function copyText(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent || element.innerText;
            
            navigator.clipboard.writeText(text).then(() => {
                showToast('✅ 已複製到剪貼簿');
            }).catch(err => {
                console.error('複製失敗:', err);
                // 退化方案：選取文字
                const range = document.createRange();
                range.selectNode(element);
                window.getSelection().removeAllRanges();
                window.getSelection().addRange(range);
                alert('請按 Ctrl+C 複製');
            });
        }
        
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-green-600 text-white px-4 py-2 rounded shadow-lg z-50 transition-opacity';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    if (toast.parentNode) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 2000);
        }
        
        // 自動生成夥伴代碼建議
        document.getElementById('partnerName').addEventListener('input', function() {
            const name = this.value.trim();
            if (name && !document.getElementById('partnerCode').value) {
                // 簡單的中文轉拼音邏輯（可以使用更完整的庫）
                const suggestion = name.replace(/\s+/g, '').toUpperCase() + '001';
                document.getElementById('partnerCode').placeholder = `建議：${suggestion}`;
            }
        });
    </script>
</body>
</html> 