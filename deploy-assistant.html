<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apps Script è‡ªå‹•éƒ¨ç½²åŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
        .code-container { max-height: 400px; overflow-y: auto; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen py-8">
    <div class="max-w-6xl mx-auto px-6">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-4">ğŸš€ Apps Script è‡ªå‹•éƒ¨ç½²åŠ©æ‰‹</h1>
            <p class="text-gray-600">ä¸€éµè¤‡è£½æœ€æ–°å¾Œç«¯ä»£ç¢¼ï¼Œå‘Šåˆ¥æ‰‹å‹•é‡è¤‡æ“ä½œ</p>
        </header>

        <!-- ç‹€æ…‹æŒ‡ç¤ºå™¨ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-xl font-semibold text-gray-800">ç•¶å‰ç‹€æ…‹</h2>
                    <p id="statusText" class="text-gray-600">æº–å‚™è¼‰å…¥æœ€æ–°ä»£ç¢¼...</p>
                </div>
                <div id="statusIcon" class="text-4xl">â³</div>
            </div>
        </div>

        <!-- å¿«é€Ÿæ“ä½œå€ -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <button onclick="loadLatestCode()" class="bg-blue-600 text-white p-4 rounded-lg hover:bg-blue-700 transition">
                <div class="text-2xl mb-2">ğŸ“¥</div>
                <div class="font-semibold">è¼‰å…¥æœ€æ–°ä»£ç¢¼</div>
            </button>
            
            <button onclick="copyToClipboard()" class="bg-green-600 text-white p-4 rounded-lg hover:bg-green-700 transition" disabled id="copyBtn">
                <div class="text-2xl mb-2">ğŸ“‹</div>
                <div class="font-semibold">è¤‡è£½åˆ°å‰ªè²¼æ¿</div>
            </button>
            
            <a href="https://script.google.com/home/projects/1buMGx7T1SFnOIygylkqQURUDFsHGidXcQ-k3kx3Xmn4/edit" target="_blank" class="bg-purple-600 text-white p-4 rounded-lg hover:bg-purple-700 transition text-center">
                <div class="text-2xl mb-2">ğŸ”—</div>
                <div class="font-semibold">æ‰“é–‹ Apps Script</div>
            </a>
        </div>

        <!-- æ­¥é©ŸæŒ‡å— -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">ğŸ“‹ ä¸‰æ­¥é©Ÿå¿«é€Ÿéƒ¨ç½²</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="text-center p-4 bg-blue-50 rounded-lg">
                    <div class="text-2xl mb-2">1ï¸âƒ£</div>
                    <div class="font-medium">è¼‰å…¥æœ€æ–°ä»£ç¢¼</div>
                    <div class="text-sm text-gray-600 mt-1">é»æ“Šã€Œè¼‰å…¥æœ€æ–°ä»£ç¢¼ã€</div>
                </div>
                <div class="text-center p-4 bg-green-50 rounded-lg">
                    <div class="text-2xl mb-2">2ï¸âƒ£</div>
                    <div class="font-medium">è¤‡è£½ä»£ç¢¼</div>
                    <div class="text-sm text-gray-600 mt-1">é»æ“Šã€Œè¤‡è£½åˆ°å‰ªè²¼æ¿ã€</div>
                </div>
                <div class="text-center p-4 bg-purple-50 rounded-lg">
                    <div class="text-2xl mb-2">3ï¸âƒ£</div>
                    <div class="font-medium">è²¼ä¸Šéƒ¨ç½²</div>
                    <div class="text-sm text-gray-600 mt-1">åœ¨ Apps Script ä¸­è²¼ä¸Šä¸¦å„²å­˜</div>
                </div>
            </div>
        </div>

        <!-- ä»£ç¢¼é è¦½å€ -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-800">ğŸ“„ æœ€æ–°å¾Œç«¯ä»£ç¢¼</h3>
                <div class="flex space-x-2">
                    <span id="codeLength" class="text-sm text-gray-500">0 å­—å…ƒ</span>
                    <span id="lastUpdate" class="text-sm text-gray-500"></span>
                </div>
            </div>
            
            <div class="code-container bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm">
                <pre id="codeContent">// é»æ“Šã€Œè¼‰å…¥æœ€æ–°ä»£ç¢¼ã€ä¾†é¡¯ç¤ºå…§å®¹...</pre>
            </div>
        </div>

        <!-- å¸¸è¦‹å•é¡Œ -->
        <div class="bg-white rounded-lg shadow-md p-6 mt-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">â“ å¸¸è¦‹å•é¡Œ</h3>
            <div class="space-y-4">
                <details class="border-l-4 border-blue-500 pl-4">
                    <summary class="font-medium cursor-pointer">å¦‚ä½•ç¢ºèªéƒ¨ç½²æˆåŠŸï¼Ÿ</summary>
                    <p class="text-gray-600 mt-2">åœ¨ Apps Script ä¸­è²¼ä¸Šä»£ç¢¼å¾Œï¼Œé»æ“Šã€Œå„²å­˜ã€åœ–ç¤ºï¼Œç„¶å¾Œé»æ“Šã€Œéƒ¨ç½²ã€â†’ã€Œç®¡ç†éƒ¨ç½²ã€â†’ã€Œç·¨è¼¯ã€â†’ã€Œç‰ˆæœ¬ã€â†’ã€Œæ–°ç‰ˆæœ¬ã€â†’ã€Œéƒ¨ç½²ã€</p>
                </details>
                
                <details class="border-l-4 border-green-500 pl-4">
                    <summary class="font-medium cursor-pointer">éƒ¨ç½²å¾Œå¦‚ä½•æ¸¬è©¦ï¼Ÿ</summary>
                    <p class="text-gray-600 mt-2">å›åˆ°ç®¡ç†å¾Œå°ï¼Œå˜—è©¦ç¢ºèªå…¥ä½åŠŸèƒ½ã€‚å¦‚æœæˆåŠŸï¼Œæœƒé¡¯ç¤ºã€Œå…¥ä½ç¢ºèªå®Œæˆï¼ä½£é‡‘å·²è¨ˆç®—ã€‚ã€</p>
                </details>
                
                <details class="border-l-4 border-purple-500 pl-4">
                    <summary class="font-medium cursor-pointer">ç‚ºä»€éº¼è¦ç¶“å¸¸æ›´æ–°ï¼Ÿ</summary>
                    <p class="text-gray-600 mt-2">ç³»çµ±æŒçºŒå„ªåŒ–ä¸­ï¼Œæ¯æ¬¡æ›´æ–°éƒ½åŒ…å«éŒ¯èª¤ä¿®å¾©å’ŒåŠŸèƒ½æ”¹é€²ï¼Œç¢ºä¿ç³»çµ±ç©©å®šé‹è¡Œã€‚</p>
                </details>
            </div>
        </div>
    </div>

    <script>
        let latestCode = '';
        
        async function loadLatestCode() {
            const statusText = document.getElementById('statusText');
            const statusIcon = document.getElementById('statusIcon');
            const copyBtn = document.getElementById('copyBtn');
            const codeContent = document.getElementById('codeContent');
            const codeLength = document.getElementById('codeLength');
            const lastUpdate = document.getElementById('lastUpdate');
            
            statusText.textContent = 'æ­£åœ¨è¼‰å…¥æœ€æ–°ä»£ç¢¼...';
            statusIcon.textContent = 'â³';
            
            try {
                // å¾ GitHub è¼‰å…¥æœ€æ–°ä»£ç¢¼
                const response = await fetch('https://raw.githubusercontent.com/didi1119/forest-gift-v1/main/backend/apps-script-commission-v2.js');
                
                if (!response.ok) {
                    throw new Error('ç„¡æ³•è¼‰å…¥ä»£ç¢¼');
                }
                
                latestCode = await response.text();
                
                // æ›´æ–° UI
                statusText.textContent = 'âœ… æœ€æ–°ä»£ç¢¼å·²è¼‰å…¥ï¼Œå¯ä»¥è¤‡è£½äº†ï¼';
                statusIcon.textContent = 'âœ…';
                copyBtn.disabled = false;
                copyBtn.classList.remove('opacity-50');
                
                codeContent.textContent = latestCode;
                codeLength.textContent = `${latestCode.length.toLocaleString()} å­—å…ƒ`;
                lastUpdate.textContent = `æ›´æ–°æ™‚é–“ï¼š${new Date().toLocaleString('zh-TW')}`;
                
            } catch (error) {
                statusText.textContent = 'âŒ è¼‰å…¥å¤±æ•—ï¼š' + error.message;
                statusIcon.textContent = 'âŒ';
                console.error('è¼‰å…¥ä»£ç¢¼å¤±æ•—:', error);
            }
        }
        
        async function copyToClipboard() {
            if (!latestCode) {
                alert('è«‹å…ˆè¼‰å…¥æœ€æ–°ä»£ç¢¼ï¼');
                return;
            }
            
            try {
                await navigator.clipboard.writeText(latestCode);
                
                // æš«æ™‚æ”¹è®ŠæŒ‰éˆ•ç‹€æ…‹
                const copyBtn = document.getElementById('copyBtn');
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = '<div class="text-2xl mb-2">âœ…</div><div class="font-semibold">å·²è¤‡è£½ï¼</div>';
                copyBtn.classList.add('bg-green-800');
                
                setTimeout(() => {
                    copyBtn.innerHTML = originalText;
                    copyBtn.classList.remove('bg-green-800');
                }, 2000);
                
                // é¡¯ç¤ºä¸‹ä¸€æ­¥æç¤º
                showNextStepGuide();
                
            } catch (error) {
                alert('è¤‡è£½å¤±æ•—ï¼š' + error.message);
            }
        }
        
        function showNextStepGuide() {
            const guide = document.createElement('div');
            guide.className = 'fixed bottom-4 right-4 bg-blue-600 text-white p-4 rounded-lg shadow-lg max-w-sm z-50';
            guide.innerHTML = `
                <h4 class="font-bold mb-2">ğŸ‰ ä»£ç¢¼å·²è¤‡è£½ï¼</h4>
                <p class="text-sm mb-3">ç¾åœ¨è«‹ï¼š</p>
                <ol class="text-sm list-decimal list-inside space-y-1">
                    <li>é»æ“Šä¸Šæ–¹ã€Œæ‰“é–‹ Apps Scriptã€</li>
                    <li>é¸æ“‡ä¸¦åˆªé™¤æ‰€æœ‰ç¾æœ‰ä»£ç¢¼</li>
                    <li>è²¼ä¸Šè¤‡è£½çš„ä»£ç¢¼ (Ctrl+V)</li>
                    <li>é»æ“Šå„²å­˜ (Ctrl+S)</li>
                    <li>é‡æ–°éƒ¨ç½²</li>
                </ol>
                <button onclick="this.parentElement.remove()" class="mt-3 bg-white text-blue-600 px-3 py-1 rounded text-sm font-medium">
                    çŸ¥é“äº†
                </button>
            `;
            
            document.body.appendChild(guide);
            
            // 5ç§’å¾Œè‡ªå‹•æ¶ˆå¤±
            setTimeout(() => {
                if (guide.parentElement) {
                    guide.remove();
                }
            }, 15000);
        }
        
        // é é¢è¼‰å…¥æ™‚è‡ªå‹•è¼‰å…¥ä»£ç¢¼
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(loadLatestCode, 1000);
        });
    </script>
</body>
</html>