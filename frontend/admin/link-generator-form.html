<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŸ¥éŸ³å¤§ä½¿å°ˆå±¬é€£çµç”Ÿæˆå™¨ (è¡¨å–®ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700&family=Noto+Sans+TC:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #FDFBF8;
            color: #5C544B;
        }
        h1, h2, h3, .font-serif {
            font-family: 'Noto Serif TC', serif;
        }
        .brand-accent {
            color: #2E4B36;
        }
        .brand-card {
            background-color: #FFFFFF;
            border: 1px solid #EAE6E1;
            border-radius: 1.5rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.05);
        }
        .link-box {
            background-color: #F8F5F2;
            border: 2px dashed #2E4B36;
            border-radius: 0.75rem;
            padding: 1rem;
            font-family: monospace;
            font-size: 0.9rem;
            word-break: break-all;
        }
    </style>
</head>
<body class="antialiased min-h-screen py-12">
    <div class="max-w-4xl mx-auto px-6">
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold brand-accent mb-4">çŸ¥éŸ³å¤§ä½¿å°ˆå±¬é€£çµç”Ÿæˆå™¨</h1>
            <p class="text-lg text-stone-600">ç‚ºæ¯ä½çŸ¥éŸ³å¤§ä½¿ç”Ÿæˆå€‹äººåŒ–çš„åˆ†äº«é€£çµä¸¦å¯«å…¥ Google Sheets</p>
            <p class="text-sm text-amber-600 mt-2">ğŸ“ ä½¿ç”¨è¡¨å–®æäº¤æ–¹å¼ï¼Œç¢ºä¿è³‡æ–™èƒ½é †åˆ©å„²å­˜</p>
        </header>

        <div class="brand-card p-8 mb-8">
            <h2 class="font-serif text-2xl font-semibold brand-accent mb-6">ç”Ÿæˆå°ˆå±¬é€£çµ</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                    <label class="block text-sm font-medium text-stone-700 mb-2">å¤¥ä¼´å§“å *</label>
                    <input type="text" id="partnerName" placeholder="ä¾‹ï¼šç‹å°æ˜" class="w-full p-3 border-2 border-stone-200 rounded-lg focus:border-green-800 focus:outline-none">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-stone-700 mb-2">å¤¥ä¼´ä»£ç¢¼ *</label>
                    <input type="text" id="partnerCode" placeholder="ä¾‹ï¼šWANG001 æˆ– xiaoming" class="w-full p-3 border-2 border-stone-200 rounded-lg focus:border-green-800 focus:outline-none">
                    <p class="text-xs text-stone-500 mt-1">å»ºè­°æ ¼å¼ï¼šå¤§å¯«å­—æ¯+æ•¸å­—ï¼Œä¾‹å¦‚ WANG001</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-stone-700 mb-2">Email</label>
                    <input type="email" id="partnerEmail" placeholder="partner@example.com" class="w-full p-3 border-2 border-stone-200 rounded-lg focus:border-green-800 focus:outline-none">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-stone-700 mb-2">å„ªæƒ åˆ¸ä»£ç¢¼</label>
                    <input type="text" id="couponCode" placeholder="ä¾‹ï¼šFOREST_WANG001" class="w-full p-3 border-2 border-stone-200 rounded-lg focus:border-green-800 focus:outline-none">
                    <p class="text-xs text-stone-500 mt-1">é¸å¡«ï¼šå¦‚æœ‰å°ˆå±¬å„ªæƒ åˆ¸å¯å¡«å…¥</p>
                </div>
                
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-stone-700 mb-2">å°ˆå±¬å„ªæƒ åˆ¸é€£çµ *</label>
                    <input type="url" id="couponUrl" placeholder="ä¾‹ï¼šhttps://lin.ee/abc123" class="w-full p-3 border-2 border-stone-200 rounded-lg focus:border-green-800 focus:outline-none">
                    <p class="text-xs text-stone-500 mt-1">è«‹è²¼ä¸Šå¾ LINE å®˜æ–¹å¸³è™Ÿå¾Œå°å–å¾—çš„å°ˆå±¬å„ªæƒ åˆ¸é€£çµ</p>
                </div>
            </div>
            
            <div class="space-y-3">
                <button onclick="generateLinks()" class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 transition duration-300">
                    ğŸ”— ç”Ÿæˆå°ˆå±¬é€£çµ
                </button>
                
                <button onclick="saveToSheets()" class="w-full bg-green-800 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-900 transition duration-300">
                    ğŸ’¾ å„²å­˜åˆ° Google Sheets
                </button>
                
                <p class="text-xs text-stone-500 text-center">
                    ç”Ÿæˆé€£çµå¾Œï¼Œè«‹é»æ“Šã€Œå„²å­˜åˆ° Google Sheetsã€å°‡è³‡æ–™å¯«å…¥ç³»çµ±
                </p>
            </div>
        </div>

        <div id="resultSection" class="brand-card p-8 hidden">
            <h3 class="font-serif text-xl font-semibold brand-accent mb-4">ç”Ÿæˆçµæœ</h3>
            
            <!-- é€£çµé¡å‹åˆ‡æ› -->
            <div class="mb-4 text-center">
                <div class="inline-flex bg-stone-100 rounded-lg p-1">
                    <button id="shortUrlToggle" onclick="toggleUrlDisplay(true)" class="px-4 py-2 text-sm rounded-md bg-green-600 text-white transition-all">
                        ğŸ“ çŸ­ç¶²å€ï¼ˆæ¨è–¦åˆ†äº«ï¼‰
                    </button>
                    <button id="fullUrlToggle" onclick="toggleUrlDisplay(false)" class="px-4 py-2 text-sm rounded-md text-stone-600 hover:text-stone-800 transition-all">
                        ğŸ”— å®Œæ•´é€£çµ
                    </button>
                </div>
                <p class="text-xs text-stone-500 mt-2">ğŸ’¡ çŸ­ç¶²å€æ›´é©åˆåˆ†äº«ï¼Œå®Œæ•´é€£çµæ–¹ä¾¿é™¤éŒ¯</p>
            </div>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-stone-700 mb-2">ä¸»é é€£çµï¼ˆé€éä¸­ç¹¼æœå‹™è¿½è¹¤ï¼‰</label>
                    <div class="link-box" id="landingLink">ç”ŸæˆçŸ­ç¶²å€ä¸­...</div>
                    <button onclick="copyText('landingLink')" class="mt-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">è¤‡è£½é€£çµ</button>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-stone-700 mb-2">LINE å®˜æ–¹å¸³è™Ÿé€£çµï¼ˆé€éä¸­ç¹¼æœå‹™è¿½è¹¤ï¼‰</label>
                    <div class="link-box" id="couponLink">ç”ŸæˆçŸ­ç¶²å€ä¸­...</div>
                    <button onclick="copyText('couponLink')" class="mt-2 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">è¤‡è£½é€£çµ</button>
                    <p class="text-xs text-stone-500 mt-1">æ³¨æ„ï¼šå„ªæƒ åˆ¸éœ€è¦åœ¨ LINE å®˜æ–¹å¸³è™Ÿå¾Œå°å¦è¡Œè¨­å®š</p>
                </div>
                
                <div class="bg-amber-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-amber-800 mb-2">ğŸ“± åˆ†äº«ç¯„æœ¬</h4>
                    <div class="text-sm text-amber-700 leading-relaxed">
                        <p id="shareTemplate"></p>
                    </div>
                    <button onclick="copyText('shareTemplate')" class="mt-3 px-3 py-1 bg-amber-600 text-white text-xs rounded hover:bg-amber-700">è¤‡è£½ç¯„æœ¬</button>
                </div>
                
                <div id="saveStatus" class="bg-gray-50 p-4 rounded-lg hidden">
                    <p class="text-gray-700">â³ å°šæœªå„²å­˜åˆ°ç³»çµ±</p>
                </div>
            </div>
        </div>

        <div class="brand-card p-8 mt-8">
            <h3 class="font-serif text-xl font-semibold brand-accent mb-4">ç³»çµ±èªªæ˜</h3>
            <div class="space-y-3 text-sm text-stone-600">
                <p><strong class="text-stone-800">é€£çµè¿½è¹¤ï¼š</strong>æ‰€æœ‰é€£çµéƒ½æœƒé€šé Apps Script ä¸­ç¹¼æœå‹™é€²è¡Œé»æ“Šè¿½è¹¤</p>
                <p><strong class="text-stone-800">çŸ­ç¶²å€æœå‹™ï¼š</strong>è‡ªå‹•ä½¿ç”¨ TinyURL å’Œ is.gd ç”Ÿæˆç°¡æ½”çš„åˆ†äº«é€£çµ</p>
                <p><strong class="text-stone-800">è³‡æ–™ç®¡ç†ï¼š</strong>å¤¥ä¼´è³‡æ–™æœƒå„²å­˜åœ¨ Google Sheetsï¼Œä½œç‚ºç³»çµ±è³‡æ–™åº«</p>
                <p><strong class="text-stone-800">ç¸¾æ•ˆçµ±è¨ˆï¼š</strong>ç³»çµ±æ¯æ—¥è‡ªå‹•å½™æ•´é»æ“Šæ•¸èˆ‡è½‰æ›æ•¸æ“š</p>
                <p><strong class="text-stone-800">çé‡‘è¨ˆç®—ï¼š</strong>åƒ…å·²ä»˜è²»ä¸”å¯¦éš›å…¥ä½çš„è¨‚æˆ¿æ‰ç®—æœ‰æ•ˆè½‰æ›</p>
                <p><strong class="text-stone-800">æŠ€è¡“èªªæ˜ï¼š</strong>ä½¿ç”¨è¡¨å–®æäº¤æ–¹å¼ï¼Œé¿å… CORS è·¨åŸŸå•é¡Œ</p>
                <p><strong class="text-amber-800">ğŸ’¡ åˆ†äº«å»ºè­°ï¼š</strong>çŸ­ç¶²å€æ›´ç¾è§€æ˜“è¨˜ï¼Œå®Œæ•´é€£çµæ–¹ä¾¿æŠ€è¡“é™¤éŒ¯</p>
            </div>
        </div>
    </div>

    <!-- éš±è—çš„ iframe ç”¨æ–¼æ¥æ”¶è¡¨å–®å›æ‡‰ -->
    <iframe id="hiddenFrame" name="hiddenFrame" style="display:none;"></iframe>

    <script>
        // è¨­å®šå€¼
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxWVmkMJUladdBVp56vcISxqCfebXaytT4_SX970OaD7Aq8wg74Kcf_9OxyNEaPA_4W/exec'; 
        const GITHUB_PAGES_URL = 'https://didi1119.github.io/forest-gift-v1'; 
        const DEFAULT_LINE_COUPON_URL = 'https://lin.ee/q38pqot';
        
        let generatedData = null;
        
        // çŸ­ç¶²å€æœå‹™å‡½æ•¸
        async function createShortUrl(originalUrl) {
            try {
                // ä½¿ç”¨ TinyURL API - å…è²»ä¸”ç©©å®š
                const response = await fetch('https://tinyurl.com/api-create.php?url=' + encodeURIComponent(originalUrl));
                
                if (response.ok) {
                    const shortUrl = await response.text();
                    // æª¢æŸ¥æ˜¯å¦ç‚ºæœ‰æ•ˆçš„çŸ­ç¶²å€
                    if (shortUrl && shortUrl.startsWith('https://tinyurl.com/')) {
                        return shortUrl;
                    }
                }
                
                // TinyURL å¤±æ•—æ™‚ï¼Œå˜—è©¦ä½¿ç”¨ is.gd
                const isGdResponse = await fetch('https://is.gd/create.php?format=simple&url=' + encodeURIComponent(originalUrl));
                if (isGdResponse.ok) {
                    const isGdShortUrl = await isGdResponse.text();
                    if (isGdShortUrl && isGdShortUrl.startsWith('https://is.gd/')) {
                        return isGdShortUrl;
                    }
                }
                
                throw new Error('æ‰€æœ‰çŸ­ç¶²å€æœå‹™éƒ½ç„¡æ³•ä½¿ç”¨');
                
            } catch (error) {
                console.warn('çŸ­ç¶²å€ç”Ÿæˆå¤±æ•—:', error);
                // å¦‚æœçŸ­ç¶²å€æœå‹™å¤±æ•—ï¼Œè¿”å›åŸå§‹ URL
                return originalUrl;
            }
        }
        
        async function generateLinks() {
            const partnerCode = document.getElementById('partnerCode').value.trim();
            const partnerName = document.getElementById('partnerName').value.trim();
            const partnerEmail = document.getElementById('partnerEmail').value.trim();
            const couponCode = document.getElementById('couponCode').value.trim();
            const couponUrl = document.getElementById('couponUrl').value.trim();
            
            if (!partnerCode || !partnerName) {
                alert('è«‹å¡«å¯«å¤¥ä¼´ä»£ç¢¼å’Œå§“å');
                return;
            }
            
            if (!couponUrl) {
                alert('è«‹æä¾›å°ˆå±¬å„ªæƒ åˆ¸é€£çµï¼\n\nè«‹åˆ° LINE å®˜æ–¹å¸³è™Ÿå¾Œå°å»ºç«‹å°ˆå±¬å„ªæƒ åˆ¸ï¼Œç„¶å¾Œå°‡é€£çµè²¼ä¸Šã€‚');
                return;
            }
            
            // é¡¯ç¤ºç”Ÿæˆä¸­ç‹€æ…‹
            document.getElementById('resultSection').classList.remove('hidden');
            document.getElementById('landingLink').textContent = 'ç”ŸæˆçŸ­ç¶²å€ä¸­...';
            document.getElementById('couponLink').textContent = 'ç”ŸæˆçŸ­ç¶²å€ä¸­...';
            document.getElementById('shareTemplate').textContent = 'ç”Ÿæˆä¸­...';
            document.getElementById('saveStatus').classList.remove('hidden');
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
            
            try {
                // ç”Ÿæˆé€é Apps Script ä¸­ç¹¼çš„é€£çµ
                const landingUrl = `${APPS_SCRIPT_URL}?pid=${encodeURIComponent(partnerCode)}&dest=landing`;
                const trackedCouponUrl = `${APPS_SCRIPT_URL}?pid=${encodeURIComponent(partnerCode)}&dest=coupon&target=${encodeURIComponent(couponUrl)}`;
                
                // ç”ŸæˆçŸ­ç¶²å€
                const shortLandingUrl = await createShortUrl(landingUrl);
                const shortCouponUrl = await createShortUrl(trackedCouponUrl);
                
                // ç”Ÿæˆåˆ†äº«ç¯„æœ¬ï¼ˆä½¿ç”¨çŸ­ç¶²å€ï¼‰
                const shareText = `ğŸŒ² ä¾†è‡ªéœè¬æ£®æ—çš„ç‰¹åˆ¥é‚€è«‹

è¦ªæ„›çš„æœ‹å‹ï¼Œæˆ‘æƒ³èˆ‡ä½ åˆ†äº«ä¸€å€‹å¾ˆç‰¹åˆ¥çš„åœ°æ–¹ â€”â€” ä¸€ç‰‡èƒ½è®“å¿ƒéˆçœŸæ­£ä¼‘æ¯çš„æ£®æ—ã€‚

é€™è£¡ä¸åªæ˜¯ä½å®¿ï¼Œæ›´æ˜¯ä¸€å ´å›åˆ°å…§å¿ƒå®¶åœ’çš„æ—…ç¨‹ã€‚æˆ‘ç‚ºä½ æº–å‚™äº†ä¸€ä»½å°ˆå±¬çš„æ£®æ—ç¦®ç‰©ï¼Œå¸Œæœ›èƒ½ç‚ºä½ çš„ç”Ÿæ´»å¸¶ä¾†ä¸€äº›ä¸ä¸€æ¨£çš„å¯§éœèˆ‡æ„Ÿå‹•ã€‚

ğŸ é»æ“Šé€£çµï¼Œé–‹å§‹ä½ çš„æ£®æ—ä¹‹æ—…ï¼š
${shortLandingUrl}

æœŸå¾…ä½ ä¹Ÿèƒ½åœ¨é€™è£¡ï¼Œæ‰¾åˆ°å±¬æ–¼è‡ªå·±çš„é‚£ä»½å®‰éœã€‚

â€”â€” ${partnerName} çœŸèª æ¨è–¦ â¤ï¸`;
                
                // ä¿å­˜ç”Ÿæˆçš„è³‡æ–™ï¼ˆåŒ…å«åŸå§‹é€£çµå’ŒçŸ­ç¶²å€ï¼‰
                generatedData = {
                    action: 'create_partner',
                    partner_code: partnerCode,
                    name: partnerName,
                    email: partnerEmail,
                    coupon_code: couponCode,
                    coupon_url: couponUrl,
                    landing_link: landingUrl,
                    coupon_link: trackedCouponUrl,
                    short_landing_link: shortLandingUrl,
                    short_coupon_link: shortCouponUrl
                };
                
                // é¡¯ç¤ºçµæœï¼ˆçŸ­ç¶²å€ï¼‰
                document.getElementById('landingLink').textContent = shortLandingUrl;
                document.getElementById('couponLink').textContent = shortCouponUrl;
                document.getElementById('shareTemplate').textContent = shareText;
                
                showToast('âœ… é€£çµå’ŒçŸ­ç¶²å€ç”ŸæˆæˆåŠŸï¼');
                
            } catch (error) {
                console.error('ç”ŸæˆçŸ­ç¶²å€å¤±æ•—:', error);
                // å¤±æ•—æ™‚ä½¿ç”¨åŸå§‹é€£çµ
                const landingUrl = `${APPS_SCRIPT_URL}?pid=${encodeURIComponent(partnerCode)}&dest=landing`;
                const trackedCouponUrl = `${APPS_SCRIPT_URL}?pid=${encodeURIComponent(partnerCode)}&dest=coupon&target=${encodeURIComponent(couponUrl)}`;
                
                const shareText = `ğŸŒ² ä¾†è‡ªéœè¬æ£®æ—çš„ç‰¹åˆ¥é‚€è«‹

è¦ªæ„›çš„æœ‹å‹ï¼Œæˆ‘æƒ³èˆ‡ä½ åˆ†äº«ä¸€å€‹å¾ˆç‰¹åˆ¥çš„åœ°æ–¹ â€”â€” ä¸€ç‰‡èƒ½è®“å¿ƒéˆçœŸæ­£ä¼‘æ¯çš„æ£®æ—ã€‚

é€™è£¡ä¸åªæ˜¯ä½å®¿ï¼Œæ›´æ˜¯ä¸€å ´å›åˆ°å…§å¿ƒå®¶åœ’çš„æ—…ç¨‹ã€‚æˆ‘ç‚ºä½ æº–å‚™äº†ä¸€ä»½å°ˆå±¬çš„æ£®æ—ç¦®ç‰©ï¼Œå¸Œæœ›èƒ½ç‚ºä½ çš„ç”Ÿæ´»å¸¶ä¾†ä¸€äº›ä¸ä¸€æ¨£çš„å¯§éœèˆ‡æ„Ÿå‹•ã€‚

ğŸ é»æ“Šé€£çµï¼Œé–‹å§‹ä½ çš„æ£®æ—ä¹‹æ—…ï¼š
${landingUrl}

æœŸå¾…ä½ ä¹Ÿèƒ½åœ¨é€™è£¡ï¼Œæ‰¾åˆ°å±¬æ–¼è‡ªå·±çš„é‚£ä»½å®‰éœã€‚

â€”â€” ${partnerName} çœŸèª æ¨è–¦ â¤ï¸`;
                
                generatedData = {
                    action: 'create_partner',
                    partner_code: partnerCode,
                    name: partnerName,
                    email: partnerEmail,
                    coupon_code: couponCode,
                    coupon_url: couponUrl,
                    landing_link: landingUrl,
                    coupon_link: trackedCouponUrl
                };
                
                document.getElementById('landingLink').textContent = landingUrl;
                document.getElementById('couponLink').textContent = trackedCouponUrl;
                document.getElementById('shareTemplate').textContent = shareText;
                
                showToast('âš ï¸ çŸ­ç¶²å€ç”Ÿæˆå¤±æ•—ï¼Œä½¿ç”¨åŸå§‹é€£çµ');
            }
        }
        
        function saveToSheets() {
            if (!generatedData) {
                alert('è«‹å…ˆç”Ÿæˆé€£çµ');
                return;
            }
            
            const button = document.querySelector('button[onclick="saveToSheets()"]');
            const originalText = button.textContent;
            button.textContent = 'å„²å­˜ä¸­...';
            button.disabled = true;
            
            try {
                // å»ºç«‹éš±è—è¡¨å–®
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = APPS_SCRIPT_URL;
                form.target = 'hiddenFrame'; // å°å‘éš±è—çš„ iframe
                form.style.display = 'none';
                
                // æ·»åŠ æ‰€æœ‰æ•¸æ“šä½œç‚ºéš±è—è¼¸å…¥
                for (const [key, value] of Object.entries(generatedData)) {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = key;
                    input.value = value || '';
                    form.appendChild(input);
                }
                
                // ç›£è½ iframe è¼‰å…¥å®Œæˆäº‹ä»¶
                const iframe = document.getElementById('hiddenFrame');
                iframe.onload = function() {
                    try {
                        // å˜—è©¦è®€å– iframe å…§å®¹ï¼ˆå¯èƒ½å› è·¨åŸŸé™åˆ¶å¤±æ•—ï¼‰
                        setTimeout(() => {
                            // å‡è¨­æˆåŠŸï¼ˆå› ç‚ºç„¡æ³•è®€å–è·¨åŸŸ iframe å…§å®¹ï¼‰
                            document.getElementById('saveStatus').innerHTML = `
                                <p class="text-green-700">âœ… è³‡æ–™å·²æäº¤å„²å­˜</p>
                                <p class="text-sm text-gray-600 mt-1">å¤¥ä¼´ä»£ç¢¼ï¼š${generatedData.partner_code}</p>
                                <p class="text-sm text-gray-600">å„ªæƒ åˆ¸ URLï¼š${generatedData.coupon_url}</p>
                                <p class="text-xs text-amber-600 mt-2">ğŸ“ è«‹æª¢æŸ¥ Google Sheets ç¢ºèªè³‡æ–™å·²æ­£ç¢ºå„²å­˜</p>
                            `;
                            document.getElementById('saveStatus').className = 'bg-green-50 p-4 rounded-lg';
                            
                            showToast('âœ… è³‡æ–™å·²æäº¤ï¼è«‹æª¢æŸ¥ Google Sheets');
                            
                            button.textContent = originalText;
                            button.disabled = false;
                        }, 2000);
                        
                    } catch (error) {
                        // è·¨åŸŸéŒ¯èª¤æ˜¯æ­£å¸¸çš„ï¼Œè¡¨ç¤ºæäº¤æˆåŠŸ
                        console.log('è·¨åŸŸé™åˆ¶ï¼Œä½†æäº¤æ‡‰è©²æˆåŠŸ');
                    }
                };
                
                // æäº¤è¡¨å–®
                document.body.appendChild(form);
                form.submit();
                document.body.removeChild(form);
                
            } catch (error) {
                console.error('æäº¤å¤±æ•—:', error);
                alert('âŒ æäº¤å¤±æ•—ï¼š' + error.message);
                
                document.getElementById('saveStatus').innerHTML = `
                    <p class="text-red-700">âŒ æäº¤å¤±æ•—ï¼š${error.message}</p>
                `;
                document.getElementById('saveStatus').className = 'bg-red-50 p-4 rounded-lg';
                
                button.textContent = originalText;
                button.disabled = false;
            }
        }
        
        let showShortUrls = true; // é è¨­é¡¯ç¤ºçŸ­ç¶²å€
        
        function toggleUrlDisplay(useShortUrl) {
            showShortUrls = useShortUrl;
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            const shortBtn = document.getElementById('shortUrlToggle');
            const fullBtn = document.getElementById('fullUrlToggle');
            
            if (useShortUrl) {
                shortBtn.className = 'px-4 py-2 text-sm rounded-md bg-green-600 text-white transition-all';
                fullBtn.className = 'px-4 py-2 text-sm rounded-md text-stone-600 hover:text-stone-800 transition-all';
            } else {
                shortBtn.className = 'px-4 py-2 text-sm rounded-md text-stone-600 hover:text-stone-800 transition-all';
                fullBtn.className = 'px-4 py-2 text-sm rounded-md bg-stone-600 text-white transition-all';
            }
            
            // å¦‚æœå·²ç¶“æœ‰ç”Ÿæˆçš„è³‡æ–™ï¼Œæ›´æ–°é¡¯ç¤º
            if (generatedData) {
                updateDisplayedLinks();
            }
        }
        
        function updateDisplayedLinks() {
            if (!generatedData) return;
            
            if (showShortUrls && generatedData.short_landing_link) {
                document.getElementById('landingLink').textContent = generatedData.short_landing_link;
                document.getElementById('couponLink').textContent = generatedData.short_coupon_link;
                // æ›´æ–°åˆ†äº«ç¯„æœ¬ä¸­çš„é€£çµ
                const shareText = document.getElementById('shareTemplate').textContent;
                const updatedShareText = shareText.replace(generatedData.landing_link, generatedData.short_landing_link);
                document.getElementById('shareTemplate').textContent = updatedShareText;
            } else {
                document.getElementById('landingLink').textContent = generatedData.landing_link;
                document.getElementById('couponLink').textContent = generatedData.coupon_link;
                // é‚„åŸåˆ†äº«ç¯„æœ¬ä¸­çš„é€£çµ
                const shareText = document.getElementById('shareTemplate').textContent;
                if (generatedData.short_landing_link) {
                    const updatedShareText = shareText.replace(generatedData.short_landing_link, generatedData.landing_link);
                    document.getElementById('shareTemplate').textContent = updatedShareText;
                }
            }
        }
        
        function copyText(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent || element.innerText;
            
            navigator.clipboard.writeText(text).then(() => {
                showToast('âœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿');
            }).catch(err => {
                console.error('è¤‡è£½å¤±æ•—:', err);
                // é€€åŒ–æ–¹æ¡ˆï¼šé¸å–æ–‡å­—
                const range = document.createRange();
                range.selectNode(element);
                window.getSelection().removeAllRanges();
                window.getSelection().addRange(range);
                alert('è«‹æŒ‰ Ctrl+C è¤‡è£½');
            });
        }
        
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-green-600 text-white px-4 py-2 rounded shadow-lg z-50 transition-opacity';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    if (toast.parentNode) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }
        
        // è‡ªå‹•ç”Ÿæˆå¤¥ä¼´ä»£ç¢¼å»ºè­°
        document.getElementById('partnerName').addEventListener('input', function() {
            const name = this.value.trim();
            if (name && !document.getElementById('partnerCode').value) {
                // ç°¡å–®çš„ä¸­æ–‡è½‰æ‹¼éŸ³é‚è¼¯
                const suggestion = name.replace(/\s+/g, '').toUpperCase() + '001';
                document.getElementById('partnerCode').placeholder = `å»ºè­°ï¼š${suggestion}`;
            }
        });
    </script>
</body>
</html>