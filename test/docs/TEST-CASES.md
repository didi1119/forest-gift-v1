# 📝 測試案例集

## 一、佣金計算測試案例

### TC001: LV1 首次推薦獎勵計算
**前置條件**
- 夥伴等級: LV1_INSIDER
- 成功推薦數: 0
- 佣金偏好: ACCOMMODATION

**測試步驟**
1. 創建訂單，房價 3000 元
2. 確認入住完成
3. 檢查佣金計算

**預期結果**
- 基礎佣金: 1000 點
- 首次獎勵: 1500 點
- 總計: 2500 點
- available_points 增加 2500
- successful_referrals 變為 1

---

### TC002: LV1 首次推薦（現金偏好）
**前置條件**
- 夥伴等級: LV1_INSIDER
- 成功推薦數: 0
- 佣金偏好: CASH

**測試步驟**
1. 創建訂單，房價 3000 元
2. 確認入住完成
3. 檢查佣金計算

**預期結果**
- 現金佣金: 500 元
- 無首次獎勵（現金無加碼）
- pending_commission 增加 500

---

### TC003: LV2 標準佣金計算
**前置條件**
- 夥伴等級: LV2_GUIDE
- 佣金偏好: ACCOMMODATION

**測試步驟**
1. 創建訂單，房價 5000 元
2. 確認入住完成

**預期結果**
- 住宿金: 1200 點
- available_points 增加 1200

---

### TC004: LV3 現金佣金計算
**前置條件**
- 夥伴等級: LV3_GUARDIAN
- 佣金偏好: CASH

**測試步驟**
1. 創建訂單，房價 10000 元
2. 確認入住完成

**預期結果**
- 現金佣金: 750 元
- pending_commission 增加 750

## 二、等級升級測試案例

### TC005: LV1 升級 LV2
**前置條件**
- 夥伴等級: LV1_INSIDER
- yearly_referrals: 3

**測試步驟**
1. 創建第 4 筆訂單
2. 確認入住完成
3. 檢查等級變化

**預期結果**
- partner_level 變為 LV2_GUIDE
- yearly_referrals 變為 4
- 後續訂單使用 LV2 佣金率

---

### TC006: LV2 升級 LV3
**前置條件**
- 夥伴等級: LV2_GUIDE
- yearly_referrals: 9

**測試步驟**
1. 創建第 10 筆訂單
2. 確認入住完成

**預期結果**
- partner_level 變為 LV3_GUARDIAN
- yearly_referrals 變為 10

---

### TC007: 跨年等級保留
**前置條件**
- 夥伴等級: LV2_GUIDE
- yearly_referrals: 5
- 當前日期: 12/31

**測試步驟**
1. 模擬日期變更為 1/1
2. 檢查等級和進度

**預期結果**
- partner_level 保持 LV2_GUIDE
- yearly_referrals 重置為 0

## 三、點數操作測試案例

### TC008: 使用住宿金折抵
**前置條件**
- available_points: 3000
- points_used: 500

**測試步驟**
1. 使用 1500 點折抵
2. 檢查餘額變化

**預期結果**
- available_points 變為 1500
- points_used 變為 2000
- total_commission_earned 不變

---

### TC009: 點數轉換現金
**前置條件**
- available_points: 2000
- pending_commission: 0

**測試步驟**
1. 轉換 1000 點為現金
2. 檢查計算結果

**預期結果**
- available_points 變為 1000
- pending_commission 增加 500 (2:1)
- 創建 Payout 記錄

---

### TC010: 點數不足處理
**前置條件**
- available_points: 500

**測試步驟**
1. 嘗試使用 1000 點
2. 檢查錯誤處理

**預期結果**
- 操作失敗
- 顯示錯誤訊息
- available_points 保持 500

## 四、訂單管理測試案例

### TC011: 手動訂房完整流程
**測試步驟**
1. 填寫所有必填欄位
2. 提交訂單
3. 檢查資料庫
4. 檢查 UI 顯示

**驗證點**
- Bookings 表新增記錄
- 所有欄位正確寫入
- UI 立即顯示新訂單
- 統計數據更新

---

### TC012: 編輯訂單 - 變更推薦人
**前置條件**
- 訂單已確認入住
- 原推薦人: PARTNER_A
- 原推薦人已獲得佣金

**測試步驟**
1. 編輯訂單
2. 變更推薦人為 PARTNER_B
3. 儲存變更

**預期結果**
- PARTNER_A 的佣金撤銷
- PARTNER_B 獲得佣金
- 兩位夥伴的統計數據都更新

---

### TC013: 取消訂單
**前置條件**
- 訂單已確認入住
- 佣金已發放

**測試步驟**
1. 取消訂單
2. 檢查佣金處理

**預期結果**
- 佣金撤銷
- available_points 減少
- successful_referrals 減 1
- 檢查是否需要降級

---

### TC014: 入住時間窗口判斷
**測試場景**
- 場景 A: 入住日期 = 今天 → 顯示確認按鈕
- 場景 B: 入住日期 = 明天 → 不顯示按鈕
- 場景 C: 入住日期 = 昨天，未確認 → 顯示確認按鈕
- 場景 D: 退房日期 > 今天+7 → 不顯示按鈕

## 五、並發操作測試案例

### TC015: 同時多筆點數操作
**測試步驟**
1. 同時發起 3 個請求：
   - 使用 1000 點
   - 轉換 500 點
   - 使用 800 點
2. 檢查最終餘額

**預期結果**
- 所有操作按序執行
- 無重複扣款
- 餘額計算正確

---

### TC016: 同時編輯同一訂單
**測試步驟**
1. 兩個用戶同時編輯
2. 檢查資料一致性

**預期結果**
- 後提交的覆蓋前面的
- 或顯示衝突提示
- 資料保持一致

## 六、邊界條件測試案例

### TC017: 零元訂單
**測試步驟**
1. 創建房價 0 元訂單
2. 確認入住

**預期結果**
- 佣金 = 0
- 不計入推薦成功數
- 不影響等級

---

### TC018: 小數點處理
**測試步驟**
1. 點數轉換 333 點（333/2=166.5）
2. 檢查計算結果

**預期結果**
- 現金 = 166 或 167（根據規則）
- 無小數點錯誤

---

### TC019: 年度邊界
**測試場景**
- 12/31 23:59 創建訂單
- 1/1 00:01 確認入住

**預期結果**
- 使用新年度的統計
- 等級判定正確

---

### TC020: 最大值測試
**測試步驟**
1. 累積超大金額點數
2. 測試顯示和計算

**預期結果**
- 無溢位錯誤
- 顯示格式正確
- 計算準確

## 七、異常處理測試案例

### TC021: 網路中斷恢復
**測試步驟**
1. 操作進行中斷網
2. 恢復後重試

**預期結果**
- 無重複提交
- 資料狀態正確
- 適當的錯誤提示

---

### TC022: 無效數據輸入
**測試場景**
- 負數金額
- 未來的確認日期
- 不存在的夥伴代碼
- SQL 注入嘗試

**預期結果**
- 全部被驗證擋下
- 顯示適當錯誤
- 系統保持穩定

---

### TC023: 資料不完整
**測試步驟**
1. 刪除必要欄位
2. 嘗試提交

**預期結果**
- 前端驗證攔截
- 後端二次驗證
- 清晰的錯誤訊息

## 八、整合流程測試案例

### TC024: 完整生命週期
**測試流程**
1. 創建新夥伴
2. 第一筆推薦（獲得獎勵）
3. 累積到升級
4. 使用部分點數
5. 轉換部分現金
6. 年度重置
7. 繼續推薦

**驗證點**
- 每個階段資料正確
- 所有連動都執行
- 歷史記錄完整

---

### TC025: 批量操作
**測試步驟**
1. 選擇 10 位夥伴
2. 批量轉換點數
3. 檢查結果

**預期結果**
- 全部成功或全部失敗
- 事務一致性
- 適當的進度顯示

## 測試優先級

### P0 - 必須測試（阻斷性）
- TC001, TC008, TC009, TC011, TC013

### P1 - 重要測試（關鍵功能）
- TC002-TC007, TC010, TC012, TC014

### P2 - 一般測試（完整性）
- TC015-TC020

### P3 - 補充測試（極端情況）
- TC021-TC025

---

最後更新：2024-08-21
維護者：測試團隊