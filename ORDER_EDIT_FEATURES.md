# 訂單編輯功能完整指南

## 🎯 功能概覽

全新的訂單編輯功能取代了原本的訂單取消，提供更完整和實用的訂單管理能力。現在您可以直接編輯所有訂單欄位，滿足房客更改日期、金額、推薦大使等各種實際需求。

## ✨ 完整功能清單

### 1. 📝 可編輯欄位

**房客資訊**
- 房客姓名 *（必填）
- 聯絡電話 *（必填）
- 電子郵件

**推薦大使**
- 推薦大使下拉選單選擇
- 即時顯示大使資訊和聯絡方式
- 動態計算預計佣金

**住宿資訊**
- 入住日期 *（必填）
- 退房日期 *（必填）
- 房價 *（必填）
- 即時佣金預覽

**訂單狀態**
- 入住狀態（待入住/已入住/已完成/已取消）
- 付款狀態（待付款/部分付款/已付清）

**其他**
- 訂單備註

### 2. 🔄 智能功能

**即時驗證**
- 必填欄位檢查
- 日期邏輯驗證（退房日期必須晚於入住日期）
- 大使代碼有效性確認

**動態更新**
- 選擇大使後即時顯示資訊
- 修改房價後即時更新佣金預覽
- 所有變更即時預覽

**資料完整性**
- 自動記錄更新時間
- 保持資料關聯性
- 操作歷史記錄

### 3. 🗑️ 刪除功能

**安全刪除**
- 完整確認對話框
- 顯示訂單詳細資訊
- 不可復原警告

**完整清理**
- 從 Google Sheets 完全移除
- 清理相關資料連結
- 操作日誌記錄

## 🔄 使用流程

### 開啟編輯功能
1. 進入 [管理後台 > 訂單管理](https://didi1119.github.io/forest-gift-v1/frontend/admin/admin-dashboard-real.html)
2. 找到要編輯的訂單
3. 點擊「✏️ 編輯訂單」按鈕

### 編輯訂單資料
1. **修改房客資訊**：更新姓名、電話、郵件
2. **更換推薦大使**：從下拉選單選擇新的大使
3. **調整住宿資訊**：修改入住日期、退房日期、房價
4. **更新訂單狀態**：調整入住狀態和付款狀態
5. **添加備註**：記錄變更原因或特殊需求

### 儲存或刪除
- 點擊「儲存變更」確認修改
- 點擊「刪除訂單」永久移除記錄
- 點擊「取消」放棄變更

## 💡 實際應用場景

### 1. 房客更改入住日期
```
原本：2025-01-15 ~ 2025-01-17
修改：2025-01-20 ~ 2025-01-22
操作：編輯入住/退房日期，系統自動重新計算住宿天數
```

### 2. 房價調整
```
原因：季節調整、升級房型、促銷優惠
操作：修改房價欄位，系統即時更新預計佣金
```

### 3. 推薦大使變更
```
原因：發現推薦來源錯誤、大使轉介
操作：重新選擇正確的推薦大使，佣金自動重新計算
```

### 4. 聯絡資訊更新
```
原因：房客電話變更、郵件錯誤
操作：更新房客聯絡資訊，保持溝通暢通
```

### 5. 訂單狀態管理
```
場景：提前入住、延遲退房、取消訂房
操作：調整對應的入住狀態和付款狀態
```

## 🔧 技術特色

### 前端功能
- **響應式設計**：完美支援桌面和手機操作
- **即時驗證**：輸入時立即檢查資料有效性
- **動態更新**：選擇變更時即時更新相關資訊
- **用戶友好**：直觀的介面和清晰的操作流程

### 後端整合
- **資料一致性**：確保所有修改正確同步到 Google Sheets
- **操作記錄**：完整的更新時間和操作歷史
- **錯誤處理**：完善的錯誤捕捉和回饋機制
- **安全驗證**：防止無效資料和惡意操作

### 佣金計算
- **智能計算**：根據大使等級和房價自動計算
- **即時預覽**：修改時立即顯示新的預計佣金
- **多種選項**：支援現金和住宿金兩種佣金類型

## 🛡️ 安全機制

### 資料驗證
- 必填欄位強制檢查
- 日期邏輯合理性驗證
- 推薦大使存在性確認
- 數值範圍合理性檢查

### 操作確認
- 重要操作需要確認對話框
- 刪除功能有明確警告
- 顯示變更前後對比

### 資料完整性
- 自動記錄操作時間
- 保持關聯資料同步
- 防止資料遺失

## 🧪 測試建議

### 基本編輯測試
```
測試步驟：
1. 開啟任一訂單編輯
2. 修改房客姓名和電話
3. 更改入住日期
4. 調整房價
5. 儲存變更
6. 確認資料正確更新
```

### 推薦大使變更測試
```
測試步驟：
1. 選擇有推薦大使的訂單
2. 更換為不同的推薦大使
3. 確認大使資訊正確顯示
4. 檢查預計佣金是否重新計算
5. 儲存並確認更新成功
```

### 日期邏輯測試
```
測試步驟：
1. 嘗試設定退房日期早於入住日期
2. 確認系統阻止並顯示錯誤訊息
3. 設定合理的日期範圍
4. 確認可以正常儲存
```

### 刪除功能測試
```
測試步驟：
1. 點擊刪除訂單按鈕
2. 確認警告對話框出現
3. 確認訂單詳細資訊正確顯示
4. 點擊確認刪除
5. 檢查訂單是否從列表中移除
```

## 📱 線上測試

- **管理後台**: https://didi1119.github.io/forest-gift-v1/frontend/admin/admin-dashboard-real.html
- **手動訂房**: https://didi1119.github.io/forest-gift-v1/frontend/admin/manual-booking.html

## 💪 優勢總結

### 相比原本取消功能的改進
1. **更靈活**：不需要取消重建，直接修改即可
2. **更實用**：滿足各種實際營運需求
3. **更安全**：完整的驗證和確認機制
4. **更直觀**：所見即所得的編輯體驗

### 營運效益
1. **節省時間**：減少重複操作
2. **減少錯誤**：即時驗證和預覽
3. **提升效率**：一次編輯完成所有修改
4. **增強追蹤**：完整的操作記錄

## 🔮 後續擴展

### 計劃中的改進
1. **批量編輯**：支援多筆訂單同時修改
2. **歷史版本**：查看訂單修改歷史
3. **範本功能**：快速套用常見修改
4. **自動化規則**：根據條件自動調整訂單

### 整合規劃
1. **通知系統**：修改後自動通知相關人員
2. **審核流程**：重要修改需要審核確認
3. **報表功能**：訂單修改統計分析
4. **API 擴展**：支援第三方系統整合

---

*功能更新時間: 2025-01-13*  
*版本: v2.3 - 完整訂單編輯*

現在您擁有了一個完整而強大的訂單管理系統，能夠應對各種實際營運需求，提供靈活、安全、高效的訂單編輯體驗！